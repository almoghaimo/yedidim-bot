<!DOCTYPE html>
<html>
<header>
    <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    <script>
        // Initialize Firebase
        // TODO: Replace with your project's customized code snippet
        var config = {
            "apiKey": "AIzaSyAwKEsWodtnrprOhYXA5tFb9zbUnLqOBk4",
            "authDomain": "yedidim-sandbox-2.firebaseapp.com",
            "databaseURL": "https://yedidim-sandbox-2.firebaseio.com",
            "projectId": "yedidim-sandbox-2",
            "storageBucket": "yedidim-sandbox-2.appspot.com",
            "messagingSenderId": "1011917548573"
        };
        firebase.initializeApp(config);
    </script>
</header>

<body>

    <div style="width: 200px; height: 200px" id="recaptcha-container"></div>
    <button type="button" id="sign-in-button">TEST BUTTON</button>

    <script>
        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');
        window.recaptchaVerifier.render()
    </script>

    <script>
        document.addEventListener("message", function (data) {
            // window.confirmationResult.confirm(data.data);
            window.postMessage(JSON.stringify({ verificationId: window.confirmationResult.verificationId, code: data.data }));
        });
    </script>

    <script>
        jQuery("#sign-in-button").click(function () {
            try {
                // alert(recaptchaVerifier)
                // window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');
                // window.recaptchaVerifier = new firebase.auth
                //     .RecaptchaVerifier("sign-in-button", {
                //         size: "invisible",
                //         callback: function (response) {
                //             alert(1)
                //         }
                //     });
                firebase
                    .auth()
                    .signInWithPhoneNumber("+447951597511", window.recaptchaVerifier)
                    .then(function (confirmationResult) {
                        alert(
                            "SMS sent. Prompt user to type the code from the message, then sign the"
                        );
                        // window.postMessage(confirmationResult.confirm, "*")
                        // user in with confirmationResult.confirm(code).
                        window.confirmationResult = confirmationResult;
                    })
                    .catch(function (error) {
                        alert(error);
                    });
                // firebase
                //     .auth()
                //     .signInWithEmailAndPassword("test@yedidim.org", "testes")
                //     .catch(function (err) {
                //         alert(err);
                //     });
            } catch (err) {
                alert(err)
            }
        })
    </script>

</body>

</html>